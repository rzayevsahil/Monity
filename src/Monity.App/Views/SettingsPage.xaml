<Page x:Class="Monity.App.Views.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d"
      d:DesignHeight="450" d:DesignWidth="600"
      Title="{DynamicResource Settings_Title}"
      Background="{DynamicResource BackgroundBrush}">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">
            <Grid Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{DynamicResource Settings_Title}" FontSize="24" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="{DynamicResource Settings_Back}" Style="{DynamicResource SecondaryButtonStyle}" Foreground="{DynamicResource TextBrush}" Click="BtnBack_Click"/>
            </Grid>

            <!-- Genel ayarlar: Tema, Dil, Windows başlangıcı, Boşta kalma, Min oturum -->
            <TextBlock Text="{DynamicResource Settings_General}" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="{DynamicResource Settings_Theme}" FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <RadioButton x:Name="RbThemeLight" Content="{DynamicResource Settings_ThemeLight}" GroupName="Theme" Margin="0,0,16,0" Foreground="{DynamicResource TextBrush}"/>
                <RadioButton x:Name="RbThemeDark" Content="{DynamicResource Settings_ThemeDark}" GroupName="Theme" Foreground="{DynamicResource TextBrush}"/>
            </StackPanel>
            <TextBlock Text="{DynamicResource Settings_Language}" FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <RadioButton x:Name="RbLanguageTr" Content="{DynamicResource Settings_LanguageTurkish}" GroupName="Language" Margin="0,0,16,0" Foreground="{DynamicResource TextBrush}"/>
                <RadioButton x:Name="RbLanguageEn" Content="{DynamicResource Settings_LanguageEnglish}" GroupName="Language" Foreground="{DynamicResource TextBrush}"/>
            </StackPanel>
            <CheckBox x:Name="CbStartWithWindows" Content="{DynamicResource Settings_StartWithWindows}" Margin="0,0,0,12" Foreground="{DynamicResource TextBrush}"/>
            <TextBlock Text="{DynamicResource Settings_IdleLabel}" FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4"/>
            <TextBlock Text="{DynamicResource Settings_IdleHint}" 
                       FontSize="11" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4" TextWrapping="Wrap"/>
            <Border Width="120" HorizontalAlignment="Left" Margin="0,0,0,12" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                <TextBox x:Name="TxtIdleThreshold" Padding="10,8" BorderThickness="0" Background="Transparent"
                         Foreground="{DynamicResource TextBrush}"
                         PreviewTextInput="TxtIdleThreshold_PreviewTextInput"
                         LostFocus="TxtIdleThreshold_LostFocus"/>
            </Border>
            <TextBlock Text="{DynamicResource Settings_MinSessionLabel}" FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4"/>
            <TextBlock Text="{DynamicResource Settings_MinSessionHint}" 
                       FontSize="11" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4" TextWrapping="Wrap"/>
            <Border Width="120" HorizontalAlignment="Left" Margin="0,0,0,8" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                <TextBox x:Name="TxtMinSessionSeconds" Padding="10,8" BorderThickness="0" Background="Transparent"
                         Foreground="{DynamicResource TextBrush}"
                         PreviewTextInput="TxtMinSessionSeconds_PreviewTextInput"
                         LostFocus="TxtMinSessionSeconds_LostFocus"/>
            </Border>
            <Button x:Name="BtnSaveGeneral" Content="{DynamicResource Settings_Save}" Style="{DynamicResource PrimaryButtonStyle}" HorizontalAlignment="Left" Margin="0,0,0,8" Click="BtnSaveGeneral_Click"/>
            <Border Height="1" Margin="0,20,0,20" Background="{DynamicResource BorderBrush}"/>

            <!-- Ignore list -->
            <TextBlock Text="{DynamicResource Settings_ExcludeTitle}" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="{DynamicResource Settings_ExcludeHint}" 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
            <Grid Margin="0,0,0,8" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Border Grid.Column="0" Margin="0,0,8,0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                    <TextBox x:Name="TxtAppSearch" Padding="10,8" BorderThickness="0" Background="Transparent"
                             Foreground="{DynamicResource TextBrush}" FontSize="13" VerticalContentAlignment="Center"
                             GotFocus="TxtAppSearch_GotFocus" LostFocus="TxtAppSearch_LostFocus"
                             TextChanged="TxtAppSearch_TextChanged"/>
                </Border>
                <Button Grid.Column="1" x:Name="BtnAppExcludeSelectAll" Content="{DynamicResource Settings_SelectAll}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Click="BtnAppExcludeSelectAll_Click"/>
                <Button Grid.Column="2" x:Name="BtnAppExcludeDeselectAll" Content="{DynamicResource Settings_DeselectAll}" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnAppExcludeDeselectAll_Click"/>
            </Grid>
            <Border Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,24" MaxHeight="220">
                <Grid>
                    <ListBox x:Name="AppExcludeList" BorderThickness="0" Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsExcluded, Mode=TwoWay}" Content="{Binding DisplayName}" Margin="0,4" Cursor="Hand" Foreground="{DynamicResource TextBrush}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <TextBlock x:Name="EmptyAppListMessage" Text="{DynamicResource Settings_EmptyAppList}" 
                               Foreground="{DynamicResource TextMutedBrush}" FontSize="12" TextWrapping="Wrap" 
                               VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed"/>
                </Grid>
            </Border>
            <Button x:Name="BtnSaveAppExclude" Content="{DynamicResource Settings_Save}" Style="{DynamicResource PrimaryButtonStyle}" HorizontalAlignment="Left" Margin="0,0,0,8" Click="BtnSaveAppExclude_Click"/>
            <Border Height="1" Margin="0,20,0,20" Background="{DynamicResource BorderBrush}"/>

            <!-- Günlük süre kısıtları -->
            <TextBlock Text="{DynamicResource Settings_DailyLimits}" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="{DynamicResource Settings_DailyLimitsHint}" 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
            <CheckBox x:Name="ChkLimitExceededCloseApp" Content="{DynamicResource Settings_LimitExceededClose}"
                      Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8" ToolTip="{DynamicResource Settings_LimitExceededCloseTooltip}"/>
            <Border Margin="0,0,0,8" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                <TextBox x:Name="TxtDailyLimitSearch" Padding="10,8" BorderThickness="0" Background="Transparent"
                         Foreground="{DynamicResource TextBrush}" FontSize="13" VerticalContentAlignment="Center"
                         GotFocus="TxtDailyLimitSearch_GotFocus" LostFocus="TxtDailyLimitSearch_LostFocus"
                         TextChanged="TxtDailyLimitSearch_TextChanged"/>
            </Border>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center">
                <TextBlock Text="{DynamicResource Settings_LimitMinutes}" VerticalAlignment="Center" Foreground="{DynamicResource TextBrush}" Margin="0,0,8,0"/>
                <Border Width="100" Margin="0,0,8,0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                    <TextBox x:Name="TxtDailyLimitMinutes" Padding="8,6" BorderThickness="0" Background="Transparent"
                             Foreground="{DynamicResource TextBrush}" VerticalContentAlignment="Center"
                             PreviewTextInput="TxtDailyLimitMinutes_PreviewTextInput"
                             LostFocus="TxtDailyLimitMinutes_LostFocus"
                             ToolTip="{DynamicResource Settings_LimitMinutesHint}"/>
                </Border>
                <TextBlock Text="{DynamicResource Settings_LimitRange}" VerticalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}" FontSize="11" Margin="0,0,16,0"/>
                <Button x:Name="BtnDailyLimitSelectAll" Content="{DynamicResource Settings_SelectAll}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Click="BtnDailyLimitSelectAll_Click"/>
                <Button x:Name="BtnDailyLimitDeselectAll" Content="{DynamicResource Settings_DeselectAll}" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnDailyLimitDeselectAll_Click"/>
            </StackPanel>
            <Border Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,24" MaxHeight="260">
                <Grid Grid.IsSharedSizeScope="True">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <!-- Tablo başlıkları: uygulama adı sütunu sabit genişlik (28 karakter) ki kısıtlı süre hep aynı yerde kalsın -->
                    <Grid Grid.Row="0" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="DailyLimitColCheck"/>
                            <ColumnDefinition Width="220" SharedSizeGroup="DailyLimitColName"/>
                            <ColumnDefinition Width="100" SharedSizeGroup="DailyLimitColLimit" MinWidth="80"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.ColumnSpan="2" Text="{DynamicResource Settings_AppName}" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="2" Text="{DynamicResource Settings_LimitColumn}" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                    </Grid>
                    <ListBox x:Name="DailyLimitList" Grid.Row="1" BorderThickness="0" Background="Transparent" Padding="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="DailyLimitColCheck"/>
                                        <ColumnDefinition Width="220" SharedSizeGroup="DailyLimitColName"/>
                                        <ColumnDefinition Width="100" SharedSizeGroup="DailyLimitColLimit" MinWidth="80"/>
                                    </Grid.ColumnDefinitions>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,8,0" Cursor="Hand" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayNameShort}" VerticalAlignment="Center" Foreground="{DynamicResource TextBrush}" ToolTip="{Binding DisplayName}" Margin="0,0,8,0"/>
                                    <TextBlock Grid.Column="2" Text="{Binding LimitDisplayText}" VerticalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}" FontSize="12" HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <TextBlock x:Name="EmptyDailyLimitMessage" Grid.Row="1" Text="{DynamicResource Settings_EmptyDailyLimit}" 
                               Foreground="{DynamicResource TextMutedBrush}" FontSize="12" TextWrapping="Wrap"
                               VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed"/>
                </Grid>
            </Border>
            <Button x:Name="BtnSaveDailyLimit" Content="{DynamicResource Settings_Save}" Style="{DynamicResource PrimaryButtonStyle}" HorizontalAlignment="Left" Margin="0,0,0,8" Click="BtnSaveDailyLimit_Click"/>
            <Border Height="1" Margin="0,20,0,20" Background="{DynamicResource BorderBrush}"/>

            <!-- Uygulama kategorileri -->
            <TextBlock Text="{DynamicResource Settings_Categories}" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="{DynamicResource Settings_CategoriesHint}" 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
            <Border Margin="0,0,0,8" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                <TextBox x:Name="TxtCategorySearch" Padding="10,8" BorderThickness="0" Background="Transparent"
                         Foreground="{DynamicResource TextBrush}" FontSize="13" VerticalContentAlignment="Center"
                         GotFocus="TxtCategorySearch_GotFocus" LostFocus="TxtCategorySearch_LostFocus"
                         TextChanged="TxtCategorySearch_TextChanged"/>
            </Border>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center">
                <TextBlock Text="{DynamicResource Settings_Category}" VerticalAlignment="Center" Foreground="{DynamicResource TextBrush}" Margin="0,0,8,0"/>
                <ComboBox x:Name="CategoryComboBox" Width="140" VerticalAlignment="Center" Margin="0,0,12,0"
                          Foreground="{DynamicResource TextBrush}"/>
                <Button x:Name="BtnApplyCategory" Content="{DynamicResource Settings_ApplyCategory}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Click="BtnApplyCategory_Click"/>
                <Button x:Name="BtnCategorySelectAll" Content="{DynamicResource Settings_SelectAll}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Click="BtnCategorySelectAll_Click"/>
                <Button x:Name="BtnCategoryDeselectAll" Content="{DynamicResource Settings_DeselectAll}" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnCategoryDeselectAll_Click"/>
            </StackPanel>
            <Border Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,24" MaxHeight="260">
                <Grid Grid.IsSharedSizeScope="True">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="CategoryColCheck"/>
                            <ColumnDefinition Width="220" SharedSizeGroup="CategoryColName"/>
                            <ColumnDefinition Width="140" SharedSizeGroup="CategoryColCombo"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="" Width="24" Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="1" Text="{DynamicResource Settings_AppName}" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="2" Text="{DynamicResource Settings_CategoryColumn}" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center"/>
                    </Grid>
                    <ListBox x:Name="CategoryList" Grid.Row="1" BorderThickness="0" Background="Transparent" Padding="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="CategoryColCheck"/>
                                        <ColumnDefinition Width="220" SharedSizeGroup="CategoryColName"/>
                                        <ColumnDefinition Width="140" SharedSizeGroup="CategoryColCombo"/>
                                    </Grid.ColumnDefinitions>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,8,0" Cursor="Hand" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayName}" VerticalAlignment="Center" Foreground="{DynamicResource TextBrush}" TextTrimming="CharacterEllipsis" Margin="0,0,12,0"/>
                                    <ComboBox Grid.Column="2" ItemsSource="{Binding CategoryOptions}" SelectedValue="{Binding CategoryName, Mode=TwoWay}" SelectedValuePath="Value" DisplayMemberPath="Display" 
                                              Foreground="{DynamicResource TextBrush}" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <TextBlock x:Name="EmptyCategoryMessage" Grid.Row="1" Text="Henüz kullanılan uygulama yok." 
                               Foreground="{DynamicResource TextMutedBrush}" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed"/>
                </Grid>
            </Border>
            <Button x:Name="BtnSaveCategory" Content="{DynamicResource Settings_Save}" Style="{DynamicResource PrimaryButtonStyle}" HorizontalAlignment="Left" Margin="0,0,0,8" Click="BtnSaveCategory_Click"/>
            <Border Height="1" Margin="0,20,0,20" Background="{DynamicResource BorderBrush}"/>

            <!-- Veri yönetimi -->
            <TextBlock Text="{DynamicResource Settings_DataManagement}" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="{DynamicResource Settings_DataManagementHint}" 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,12" TextWrapping="Wrap"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                <Button x:Name="BtnDelete30Days" Content="{DynamicResource Settings_Delete30}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Tag="30" Click="BtnDeleteOldData_Click"/>
                <Button x:Name="BtnDelete90Days" Content="{DynamicResource Settings_Delete90}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Tag="90" Click="BtnDeleteOldData_Click"/>
                <Button x:Name="BtnDelete365Days" Content="{DynamicResource Settings_Delete365}" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Tag="365" Click="BtnDeleteOldData_Click"/>
                <Button x:Name="BtnDeleteAll" Content="{DynamicResource Settings_DeleteAll}" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnDeleteAll_Click"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
