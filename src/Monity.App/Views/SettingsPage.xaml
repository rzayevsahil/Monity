<Page x:Class="Monity.App.Views.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d"
      d:DesignHeight="450" d:DesignWidth="600"
      Title="Ayarlar"
      Background="{DynamicResource BackgroundBrush}">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">
            <Grid Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Ayarlar" FontSize="24" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="← Geri" Style="{DynamicResource SecondaryButtonStyle}" Foreground="{DynamicResource TextBrush}" Click="BtnBack_Click"/>
            </Grid>

            <!-- Tema -->
            <TextBlock Text="Tema" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                <RadioButton x:Name="RbThemeLight" Content="Açık" GroupName="Theme" Margin="0,0,16,0" Foreground="{DynamicResource TextBrush}"/>
                <RadioButton x:Name="RbThemeDark" Content="Koyu" GroupName="Theme" Foreground="{DynamicResource TextBrush}"/>
            </StackPanel>

            <!-- Windows başlangıcında otomatik başlat -->
            <CheckBox x:Name="CbStartWithWindows" Content="Windows başlangıcında otomatik başlat" Margin="0,0,0,24" Foreground="{DynamicResource TextBrush}"/>

            <!-- Idle threshold -->
            <TextBlock Text="Boşta kalma süresi (saniye)" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="Bu süre boyunca klavye veya fareye hiç dokunmazsanız, artık süre sayılmaz (örneğin ekrandan uzaklaştığınızda). 10 ile 600 saniye arası bir değer girin (60 = 1 dakika)." 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
            <Border Width="120" HorizontalAlignment="Left" Margin="0,0,0,24" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                <TextBox x:Name="TxtIdleThreshold" Padding="10,8" BorderThickness="0" Background="Transparent"
                         Foreground="{DynamicResource TextBrush}"
                         PreviewTextInput="TxtIdleThreshold_PreviewTextInput"
                         LostFocus="TxtIdleThreshold_LostFocus"/>
            </Border>

            <!-- Ignore list -->
            <TextBlock Text="Takip hariç tutulacak uygulamalar" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="Aşağıdaki listeden takip etmek istemediğiniz uygulamaları işaretleyin. Listede yalnızca daha önce kullanılmış uygulamalar görünür. Monity ve Windows Gezgini zaten takip dışıdır." 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
            <Grid Margin="0,0,0,8" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Border Grid.Column="0" Margin="0,0,8,0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                    <TextBox x:Name="TxtAppSearch" Padding="10,8" BorderThickness="0" Background="Transparent"
                             Foreground="{DynamicResource TextBrush}" FontSize="13" VerticalContentAlignment="Center"
                             GotFocus="TxtAppSearch_GotFocus" LostFocus="TxtAppSearch_LostFocus"
                             TextChanged="TxtAppSearch_TextChanged"/>
                </Border>
                <Button Grid.Column="1" x:Name="BtnAppExcludeSelectAll" Content="Hepsini seç" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Click="BtnAppExcludeSelectAll_Click"/>
                <Button Grid.Column="2" x:Name="BtnAppExcludeDeselectAll" Content="Hepsini sil" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnAppExcludeDeselectAll_Click"/>
            </Grid>
            <Border Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,24" MaxHeight="220">
                <Grid>
                    <ListBox x:Name="AppExcludeList" BorderThickness="0" Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsExcluded, Mode=TwoWay}" Content="{Binding DisplayName}" Margin="0,4" Cursor="Hand" Foreground="{DynamicResource TextBrush}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <TextBlock x:Name="EmptyAppListMessage" Text="Henüz kullanılan uygulama yok. Uygulamaları kullandıkça burada listelenecektir." 
                               Foreground="{DynamicResource TextMutedBrush}" FontSize="12" TextWrapping="Wrap" 
                               VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed"/>
                </Grid>
            </Border>

            <!-- Günlük süre kısıtları (takip hariç listesi gibi: arama + liste + tek input) -->
            <TextBlock Text="Günlük süre kısıtları" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="Listeden uygulama(lar) seçin, dakika girin ve Kaydet'e basın; limit aşıldığında bildirim alırsınız. Kısıtlı süre kaydedildikten sonra sağ sütunda görünür." 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
            <Border Margin="0,0,0,8" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                <TextBox x:Name="TxtDailyLimitSearch" Padding="10,8" BorderThickness="0" Background="Transparent"
                         Foreground="{DynamicResource TextBrush}" FontSize="13" VerticalContentAlignment="Center"
                         GotFocus="TxtDailyLimitSearch_GotFocus" LostFocus="TxtDailyLimitSearch_LostFocus"
                         TextChanged="TxtDailyLimitSearch_TextChanged"/>
            </Border>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center">
                <TextBlock Text="Kısıtlı süre (dakika):" VerticalAlignment="Center" Foreground="{DynamicResource TextBrush}" Margin="0,0,8,0"/>
                <Border Width="100" Margin="0,0,8,0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8">
                    <TextBox x:Name="TxtDailyLimitMinutes" Padding="8,6" BorderThickness="0" Background="Transparent"
                             Foreground="{DynamicResource TextBrush}" VerticalContentAlignment="Center"
                             PreviewTextInput="TxtDailyLimitMinutes_PreviewTextInput"
                             LostFocus="TxtDailyLimitMinutes_LostFocus"
                             ToolTip="Seçili uygulamalara uygulanacak dakika (1-1440 = 24 saat)"/>
                </Border>
                <TextBlock Text="1-1440 arası değer giriniz." VerticalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}" FontSize="11" Margin="0,0,16,0"/>
                <Button x:Name="BtnDailyLimitSelectAll" Content="Hepsini seç" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Click="BtnDailyLimitSelectAll_Click"/>
                <Button x:Name="BtnDailyLimitDeselectAll" Content="Hepsini sil" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnDailyLimitDeselectAll_Click"/>
            </StackPanel>
            <Border Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,24" MaxHeight="260">
                <Grid Grid.IsSharedSizeScope="True">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <!-- Tablo başlıkları: uygulama adı sütunu sabit genişlik (28 karakter) ki kısıtlı süre hep aynı yerde kalsın -->
                    <Grid Grid.Row="0" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="DailyLimitColCheck"/>
                            <ColumnDefinition Width="220" SharedSizeGroup="DailyLimitColName"/>
                            <ColumnDefinition Width="100" SharedSizeGroup="DailyLimitColLimit" MinWidth="80"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.ColumnSpan="2" Text="Uygulama adı" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="2" Text="Kısıtlı süre" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                    </Grid>
                    <ListBox x:Name="DailyLimitList" Grid.Row="1" BorderThickness="0" Background="Transparent" Padding="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="DailyLimitColCheck"/>
                                        <ColumnDefinition Width="220" SharedSizeGroup="DailyLimitColName"/>
                                        <ColumnDefinition Width="100" SharedSizeGroup="DailyLimitColLimit" MinWidth="80"/>
                                    </Grid.ColumnDefinitions>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,8,0" Cursor="Hand" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayNameShort}" VerticalAlignment="Center" Foreground="{DynamicResource TextBrush}" ToolTip="{Binding DisplayName}" Margin="0,0,8,0"/>
                                    <TextBlock Grid.Column="2" Text="{Binding LimitDisplayText}" VerticalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}" FontSize="12" HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <TextBlock x:Name="EmptyDailyLimitMessage" Grid.Row="1" Text="Henüz kullanılan uygulama yok. Uygulamaları kullandıkça burada listelenecektir." 
                               Foreground="{DynamicResource TextMutedBrush}" FontSize="12" TextWrapping="Wrap"
                               VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed"/>
                </Grid>
            </Border>

            <!-- Veri yönetimi -->
            <TextBlock Text="Veri yönetimi" FontSize="14" Foreground="{DynamicResource TextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="Eski kullanım verilerini silmek veya tüm verileri temizlemek için aşağıdaki butonları kullanın. Bu işlem geri alınamaz." 
                       FontSize="12" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,12" TextWrapping="Wrap"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                <Button x:Name="BtnDelete30Days" Content="30 günden eski verileri sil" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Tag="30" Click="BtnDeleteOldData_Click"/>
                <Button x:Name="BtnDelete90Days" Content="90 günden eski verileri sil" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Tag="90" Click="BtnDeleteOldData_Click"/>
                <Button x:Name="BtnDelete365Days" Content="365 günden eski verileri sil" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,8,0" Tag="365" Click="BtnDeleteOldData_Click"/>
                <Button x:Name="BtnDeleteAll" Content="Tüm verileri sil" Style="{DynamicResource SecondaryButtonStyle}" Click="BtnDeleteAll_Click"/>
            </StackPanel>

            <!-- Save -->
            <Button Content="Kaydet" Style="{DynamicResource PrimaryButtonStyle}" HorizontalAlignment="Left" Click="BtnSave_Click"/>
        </StackPanel>
    </ScrollViewer>
</Page>
